{
    "name": "[CasperID] Gemini API Cost Spike",
    "type": "query alert",
    "query": "avg(last_15m):anomalies(sum:casperid.gemini.cost.estimated{*}, 'agile', 3, direction='above') >= 1",
    "message": "ðŸ’° COST ALERT: Gemini API Usage Anomaly\n\n**Current Cost Rate:** ${{value}}/hour\n**Spike Detected:** Anomaly threshold exceeded\n\n**Potential Causes:**\n- DoS attack (automated verification requests)\n- Infinite retry loop\n- Traffic spike from viral content\n- Bot activity\n\n**Immediate Actions:**\n1. Enable rate limiting immediately\n2. Check for suspicious IP addresses\n3. Review request patterns in logs\n4. Consider temporarily disabling public endpoints\n\n@slack-casperid-critical @pagerduty",
    "tags": [
        "cost",
        "gemini",
        "anomaly",
        "security",
        "casperid-api"
    ],
    "options": {
        "notify_audit": false,
        "locked": false,
        "timeout_h": 0,
        "include_tags": true,
        "no_data_timeframe": 20,
        "require_full_window": false,
        "new_host_delay": 300,
        "notify_no_data": false,
        "renotify_interval": 60,
        "thresholds": {
            "critical": 1,
            "warning": 0.5
        },
        "threshold_windows": {
            "trigger_window": "last_15m",
            "recovery_window": "last_15m"
        }
    },
    "priority": 1
}